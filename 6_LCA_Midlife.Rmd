#####                                                       #####
##### LATENT CLASS ANALYSIS                                 #####
#####                                                       #####

```{r}
##### LOAD PACKAGES
library(poLCA)

```

```{r}
##### LOAD DATASET
PFAS <-read_csv("C:/Users/jarva/Desktop/James-Todd Lab/PFASandMidlife/Data/PFAS_DEMO.csv")

```

```{r}

ad <- as.formula(cbind(PFAS$VAT_AREA_mdxa17, PFAS$SAT_AREA_mdxa17, PFAS$TAT_AREA_mdxa17, 
                       PFAS$WEIGHT_mdxa17, PFAS$mom_waist_ma17, PFAS$mom_bodyfat_ma17)~1)

```

```{r}

LCA3 <- poLCA(ad, data = PFAS, nclass = 3)
plot(LCA3)

```

#slide10:

vars <- c("mhintake", "mhdiageval", "mhreferral", "treatmt","adminserv")
for (i in 1:length(vars)){
	samhsa2015[,vars[i]] <- samhsa2015[,vars[i]]+1
}

f1 <- as.formula(cbind(mhintake, mhdiageval, mhreferral, treatmt, adminserv)~1)
LCA2 <- poLCA(f1, data=samhsa2015, nclass=2)

#slide13:
plot(LCA2)

#slide14:
LCA3 <- poLCA(f1, data=samhsa2015, nclass=3)

#slide15:
LCA3 <- poLCA(f1, data=samhsa2015, nclass=3, maxiter=3000)
LCA3 <- poLCA(f1, data=samhsa2015, nclass=3, nrep=5)
LCA3 <- poLCA(f1, data=samhsa2015, nclass=3, maxiter=3000, nrep=5)

LCA4 <- poLCA(f1, data=samhsa2015, nclass=4, maxiter=3000, nrep=5)
#LCA4 <- poLCA(f1, data=samhsa2015, nclass=4, maxiter=5000, nrep=5)

LCA5 <- poLCA(f1, data=samhsa2015, nclass=5, maxiter=5000, nrep=10)

### with covariate - 'offer pay assistance' 
#slide19:
f2<- as.formula(cbind(mhintake, mhdiageval, mhreferral, treatmt, adminserv)~payasst)

#set.seed(4589)
LCA3c <- poLCA(f2, data=samhsa2015, nclass=3, maxiter=5000, nrep=5)

#predicted class membership is in:
LCA3$predclass[1:30]

#could be used as another variable (part of the data):
samhsa2015$LCAf5 <- LCA3$predclass


