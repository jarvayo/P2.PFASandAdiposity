#####                                                       #####
##### PRE-LIMINARY ANALYSIS                                 #####
#####                                                       #####

```{r}
##### LOAD PACKAGES
library("tidyverse")
library("modelsummary")
library("kableExtra")
library("gt")
library("shiny")
library("olsrr")

```

```{r}
##### LOAD DATASET
PFAS_A <-read_csv("C:/Users/jarva/Desktop/James-Todd Lab/PFASandAdiposity/Data/PFAS_A.csv")
PFAS_D <-read_csv("C:/Users/jarva/Desktop/James-Todd Lab/PFASandAdiposity/Data/PFAS_D.csv")

```

```{r}
##### RUN UNADJUSTED LINEAR REGRESSION MODELS, ANTHRO DATASET (N = 549)

# BMI
unad.lnm.bmi <- list(
  "PFOS" = glm(LNBMI ~ LNPFOS, family = gaussian, data = PFAS_A),
  "PFOA" = glm(LNBMI ~ LNPFOA, family = gaussian, data = PFAS_A),
  "PFNA" = glm(LNBMI ~ LNPFNA2, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(LNBMI ~ LNPFHxS, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(LNBMI ~ LNME_PFOSA, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(LNBMI ~ LNET_PFOSA, family = gaussian, data = PFAS_A))
modelsummary(unad.lnm.bmi, fmt = 2, title = "PFAS vs. LN-BMI (Unadjusted)")


# WAIST CIRCUMFERENCE
unad.m.waist <- list(
  "PFOS" = glm(Waist ~ LNPFOS, family = gaussian, data = PFAS_A),
  "PFOA" = glm(Waist ~ LNPFOA, family = gaussian, data = PFAS_A),
  "PFNA" = glm(Waist ~ LNPFNA2, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(Waist ~ LNPFHxS, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(Waist ~ LNME_PFOSA, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(Waist ~ LNET_PFOSA, family = gaussian, data = PFAS_A))
modelsummary(unad.m.waist, fmt = 2, title = "PFAS vs. WAIST CIRCUMFERENCE (Unadjusted)")


# WAIST-TO-HIP RATIO
unad.m.whr <- list(
  "PFOS" = glm(WHR ~ LNPFOS, family = gaussian, data = PFAS_A),
  "PFOA" = glm(WHR ~ LNPFOA, family = gaussian, data = PFAS_A),
  "PFNA" = glm(WHR ~ LNPFNA2, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(WHR ~ LNPFHxS, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(WHR ~ LNME_PFOSA, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(WHR ~ LNET_PFOSA, family = gaussian, data = PFAS_A))
modelsummary(unad.m.whr, fmt = 2, title = "PFAS vs. WHR (Unadjusted)")


# MUAC
unad.m.muac <- list(
  "PFOS" = glm(MUAC ~ LNPFOS, family = gaussian, data = PFAS_A),
  "PFOA" = glm(MUAC ~ LNPFOA, family = gaussian, data = PFAS_A),
  "PFNA" = glm(MUAC ~ LNPFNA2, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(MUAC ~ LNPFHxS, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(MUAC ~ LNME_PFOSA, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(MUAC ~ LNET_PFOSA, family = gaussian, data = PFAS_A))
modelsummary(unad.m.muac, fmt = 2, title = "PFAS vs. MUAC (Unadjusted)")

```

```{r}
##### RUN UNADJUSTED LINEAR REGRESSION MODELS, ANTHRO + DXA DATASET (N = 429)

# TRUNK FAT MASS
unad.lnm.trnkfat <- list(
  "PFOS" = glm(LNTKNFAT ~ LNPFOS, family = gaussian, data = PFAS_D),
  "PFOA" = glm(LNTKNFAT ~ LNPFOA, family = gaussian, data = PFAS_D),
  "PFNA" = glm(LNTKNFAT ~ LNPFNA2, family = gaussian, data = PFAS_D),
  "PFHxS" = glm(LNTKNFAT ~ LNPFHxS, family = gaussian, data = PFAS_D),
  "MeFOSSA" = glm(LNTKNFAT ~ LNME_PFOSA, family = gaussian, data = PFAS_D),
  "EtFOSSA" = glm(LNTKNFAT ~ LNET_PFOSA, family = gaussian, data = PFAS_D))
modelsummary(unad.lnm.trnkfat, fmt = 2, title = "PFAS vs. LN-TRUNK FAT MASS (Unadjusted)")


# TOTAL BODY FAT MASS
unad.lnm.totfat <- list(
  "PFOS" = glm(LNTOTFAT ~ LNPFOS, family = gaussian, data = PFAS_D),
  "PFOA" = glm(LNTOTFAT ~ LNPFOA, family = gaussian, data = PFAS_D),
  "PFNA" = glm(LNTOTFAT ~ LNPFNA2, family = gaussian, data = PFAS_D),
  "PFHxS" = glm(LNTOTFAT ~ LNPFHxS, family = gaussian, data = PFAS_D),
  "MeFOSSA" = glm(LNTOTFAT ~ LNME_PFOSA, family = gaussian, data = PFAS_D),
  "EtFOSSA" = glm(LNTOTFAT ~ LNET_PFOSA, family = gaussian, data = PFAS_D))
modelsummary(unad.lnm.totfat, fmt = 2, title = "PFAS vs. LN-TOTAL BODY FAT MASS (Unadjusted)")


# TOTAL BODY FAT %
unad.m.totpfat <- list(
  "PFOS" = glm(TotFatPct ~ LNPFOS, family = gaussian, data = PFAS_D),
  "PFOA" = glm(TotFatPct ~ LNPFOA, family = gaussian, data = PFAS_D),
  "PFNA" = glm(TotFatPct ~ LNPFNA2, family = gaussian, data = PFAS_D),
  "PFHxS" = glm(TotFatPct ~ LNPFHxS, family = gaussian, data = PFAS_D),
  "MeFOSSA" = glm(TotFatPct ~ LNME_PFOSA, family = gaussian, data = PFAS_D),
  "EtFOSSA" = glm(TotFatPct ~ LNET_PFOSA, family = gaussian, data = PFAS_D))
modelsummary(unad.m.totpfat, fmt = 2, title = "PFAS vs. TOTAL BODY FAT % (Unadjusted)")

```


```{r}
##### RUN ADJUSTED LINEAR REGRESSION MODELS, ANTHRO DATASET (N = 549)

# BMI
ad.lnm.bmi <- list(
  "PFOS" = glm(LNBMI ~ LNPFOS + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFOA" = glm(LNBMI ~ LNPFOA + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFNA" = glm(LNBMI ~ LNPFNA2 + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(LNBMI ~ LNPFHxS + age_enroll + race + edu + menar + smoke +  
                  parity + married, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(LNBMI ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(LNBMI ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A))

modelsummary(ad.lnm.bmi, fmt = 2,
             estimate = "{estimate}{stars}",
             statistic = c("SE: {std.error}",
                           "95% CI: [{conf.low}, {conf.high}]"),
             coef_omit = "Interc", title = "PFAS vs. LN-BMI (Adjusted)")


# WAIST CIRCUMFERENCE
ad.m.waist <- list(
  "PFOS" = glm(Waist ~ LNPFOS + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFOA" = glm(Waist ~ LNPFOA + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFNA" = glm(Waist ~ LNPFNA2 + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(Waist ~ LNPFHxS + age_enroll + race + edu + menar + smoke +  
                  parity + married, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(Waist ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(Waist ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A))

modelsummary(ad.m.waist, fmt = 2,
             estimate = "{estimate}{stars}",
             statistic = c("SE: {std.error}",
                           "95% CI: [{conf.low}, {conf.high}]"),
             coef_omit = "Interc", title = "PFAS vs. WAIST CIRCUMFERENCE (Adjusted)")


# WAIST-TO-HIP RATIO
ad.m.whr <- list(
  "PFOS" = glm(WHR ~ LNPFOS + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFOA" = glm(WHR ~ LNPFOA + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFNA" = glm(WHR ~ LNPFNA2 + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(WHR ~ LNPFHxS + age_enroll + race + edu + menar + smoke +  
                  parity + married, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(WHR ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(WHR ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A))

modelsummary(ad.m.whr, fmt = 2,
             estimate = "{estimate}{stars}",
             statistic = c("SE: {std.error}",
                           "95% CI: [{conf.low}, {conf.high}]"),
             coef_omit = "Interc", title = "PFAS vs. WHR (Adjusted)")


# MUAC
ad.m.muac <- list(
  "PFOS" = glm(MUAC ~ LNPFOS + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFOA" = glm(MUAC ~ LNPFOA + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFNA" = glm(MUAC ~ LNPFNA2 + age_enroll + race + edu + menar + smoke +  
                 parity + married, family = gaussian, data = PFAS_A),
  "PFHxS" = glm(MUAC ~ LNPFHxS + age_enroll + race + edu + menar + smoke +  
                  parity + married, family = gaussian, data = PFAS_A),
  "MeFOSSA" = glm(MUAC ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A),
  "EtFOSSA" = glm(MUAC ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke +  
                    parity + married, family = gaussian, data = PFAS_A))

modelsummary(ad.m.muac, fmt = 2,
             estimate = "{estimate}{stars}",
             statistic = c("SE: {std.error}",
                           "95% CI: [{conf.low}, {conf.high}]"),
             coef_omit = "Interc", title = "PFAS vs. MUAC (Adjusted)")

```


```{r}
##### RUN ADJUSTED LINEAR REGRESSION MODELS, ANTHRO + DXA DATASET (N = 429)

# TRUNK FAT MASS
ad.lnm.trnkfat <- list(
  "PFOS" = glm(LNTKNFAT ~ LNPFOS + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFOA" = glm(LNTKNFAT ~ LNPFOA + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFNA" = glm(LNTKNFAT ~ LNPFNA2 + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFHxS" = glm(LNTKNFAT ~ LNPFHxS + age_enroll + race + edu + menar + smoke + 
                  parity + married, family = gaussian, data = PFAS_D),
  "MeFOSSA" = glm(LNTKNFAT ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke + 
                    parity + married, family = gaussian, data = PFAS_D),
  "EtFOSSA" = glm(LNTKNFAT ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke + 
                    parity + married, family = gaussian, data = PFAS_D))

modelsummary(ad.lnm.trnkfat, fmt = 2, estimate = "{estimate}{stars}", 
             statistic = c("SE: {std.error}", "95% CI: [{conf.low}, {conf.high}]"), 
             coef_omit = "Interc", title = "PFAS vs. LN-TRUNK FAT MASS (Unadjusted)")


# TOTAL BODY FAT MASS
ad.lnm.totfat <- list(
  "PFOS" = glm(LNTOTFAT ~ LNPFOS + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFOA" = glm(LNTOTFAT ~ LNPFOA + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFNA" = glm(LNTOTFAT ~ LNPFNA2 + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFHxS" = glm(LNTOTFAT ~ LNPFHxS + age_enroll + race + edu + menar + smoke + 
                  parity + married, family = gaussian, data = PFAS_D),
  "MeFOSSA" = glm(LNTOTFAT ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke + 
                    parity + married, family = gaussian, data = PFAS_D),
  "EtFOSSA" = glm(LNTOTFAT ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke + 
                    parity + married, family = gaussian, data = PFAS_D))

modelsummary(ad.lnm.totfat, fmt = 2, estimate = "{estimate}{stars}", 
             statistic = c("SE: {std.error}", "95% CI: [{conf.low}, {conf.high}]"), 
             coef_omit = "Interc", title = "PFAS vs. LN-TOTAL BODY FAT MASS (Unadjusted)")


# TOTAL BODY FAT %
ad.m.totpfat <- list(
  "PFOS" = glm(TotFatPct ~ LNPFOS + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFOA" = glm(TotFatPct ~ LNPFOA + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFNA" = glm(TotFatPct ~ LNPFNA2 + age_enroll + race + edu + menar + smoke + 
                 parity + married, family = gaussian, data = PFAS_D),
  "PFHxS" = glm(TotFatPct ~ LNPFHxS + age_enroll + race + edu + menar + smoke + 
                  parity + married, family = gaussian, data = PFAS_D),
  "MeFOSSA" = glm(TotFatPct ~ LNME_PFOSA + age_enroll + race + edu + menar + smoke + 
                    parity + married, family = gaussian, data = PFAS_D),
  "EtFOSSA" = glm(TotFatPct ~ LNET_PFOSA + age_enroll + race + edu + menar + smoke + 
                    parity + married, family = gaussian, data = PFAS_D))

modelsummary(ad.m.totpfat, fmt = 2, estimate = "{estimate}{stars}", 
             statistic = c("SE: {std.error}", "95% CI: [{conf.low}, {conf.high}]"), 
             coef_omit = "Interc", title = "PFAS vs. TOTAL BODY FAT % (Unadjusted)")

```

```{r}
##### PLOT THE ADJUSTED LINEAR MODEL COEFFICIENTS 
modelplot(ad.lnm.bmi, coef_omit = "Interc")
modelplot(ad.m.waist, coef_omit = "Interc")
modelplot(ad.m.whr, coef_omit = "Interc")
modelplot(ad.m.muac, coef_omit = "Interc")

modelplot(ad.lnm.trnkfat, coef_omit = "Interc")
modelplot(ad.lnm.totfat, coef_omit = "Interc")
modelplot(ad.m.totpfat, coef_omit = "Interc")

```

