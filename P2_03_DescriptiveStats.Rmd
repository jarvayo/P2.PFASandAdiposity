#####                                                       #####
##### EVALUATE DISTRIBUTION OF VARIABLES AND CREATE TABLE 1 #####
#####                                                       #####

```{r}
##### LOAD PACKAGES
library("tidyverse")
library("plyr")
library("table1")
library("gtools")
library("corrplot")
library("Hmisc")

```

```{r}
##### LOAD DATASET
PFAS_A <-read.csv("C:/Users/jarva/Desktop/James-Todd Lab/PFASandAdiposity/Data/PFAS_A_COMP.csv")
PFAS_AD <-read.csv("C:/Users/jarva/Desktop/James-Todd Lab/PFASandAdiposity/Data/PFAS_AD_COMP.csv")

```


```{r}
##### LOG-TRANSFORM PFAS TO OBSERVE SHAPE OF DISTRIBUTION
PFAS_A$LNPFOS <- log(PFAS_A$PFOS)
PFAS_A$LNPFOA <- log(PFAS_A$PFOA)
PFAS_A$LNPFNA2 <- log(PFAS_A$PFNA2)
PFAS_A$LNPFHxS <- log(PFAS_A$PFHxS)
PFAS_A$LNME_PFOSA <- log(PFAS_A$Me_PFOSA_AcOH2)
PFAS_A$LNET_PFOSA <- log(PFAS_A$Et_PFOSA_AcOH)

PFAS_AD$LNPFOS <- log(PFAS_AD$PFOS)
PFAS_AD$LNPFOA <- log(PFAS_AD$PFOA)
PFAS_AD$LNPFNA2 <- log(PFAS_AD$PFNA2)
PFAS_AD$LNPFHxS <- log(PFAS_AD$PFHxS)
PFAS_AD$LNME_PFOSA <- log(PFAS_AD$Me_PFOSA_AcOH2)
PFAS_AD$LNET_PFOSA <- log(PFAS_AD$Et_PFOSA_AcOH)


##### LOG-TRANSFORM DXA MEASURES (AND BMI/WEIGHT GAIN/WAIST CIRCUMFERENCE) TO OBSERVE SHAPE OF DISTRIBUTION
PFAS_A$LNBMI <- log(PFAS_A$mom_bmi_MT)
PFAS_A$LNWAIST <- log(PFAS_A$mom_waist_ma17)
PFAS_A$LNHIP <- log(PFAS_A$mom_hip_ma17)
PFAS_A$LNBFAT <- log(PFAS_A$mom_bodyfat_ma17)
PFAS_A$LNFAT <- log(PFAS_A$mom_fat_ma17)
PFAS_A$LNWT <- log(PFAS_A$mom_weight_ma17)

PFAS_AD$LNVAT_AREA <- log(PFAS_AD$VAT_AREA_mdxa17)
PFAS_AD$LNSAT_AREA <- log(PFAS_AD$SAT_AREA_mdxa17)
PFAS_AD$LNTAT_AREA <- log(PFAS_AD$TAT_AREA_mdxa17)
PFAS_AD$LNVAT_MASS <- log(PFAS_AD$VAT_MASS_mdxa17)
PFAS_AD$LNSAT_MASS <- log(PFAS_AD$SAT_MASS_mdxa17)
PFAS_AD$LNTAT_MASS <- log(PFAS_AD$TAT_MASS_mdxa17)
PFAS_AD$LNVAT_VOLUME <- log(PFAS_AD$VAT_VOLUME_mdxa17)
PFAS_AD$LNSAT_VOLUME <- log(PFAS_AD$SAT_VOLUME_mdxa17)
PFAS_AD$LNTAT_VOLUME <- log(PFAS_AD$TAT_VOLUME_mdxa17)
PFAS_AD$LNWT <- log(PFAS_AD$WEIGHT_mdxa17)
PFAS_AD$LNBMI <- log(PFAS_AD$mom_bmi_MT)
PFAS_AD$LNWAIST <- log(PFAS_AD$mom_waist_ma17)
PFAS_AD$LNHIP <- log(PFAS_AD$mom_hip_ma17)
PFAS_AD$LNBFAT <- log(PFAS_AD$mom_bodyfat_ma17)
PFAS_AD$LNFAT <- log(PFAS_AD$mom_fat_ma17)

```

```{r}
##### DESCRIBE PFAS DISTRIBUTION, ANTHRO DATASET
hist(PFAS_A$PFOS)
hist(PFAS_A$PFOA)
#hist(PFAS_A$PFOSA)
hist(PFAS_A$PFNA2)
hist(PFAS_A$PFHxS)
#hist(PFAS_A$PFDeA)
hist(PFAS_A$Me_PFOSA_AcOH2)
hist(PFAS_A$Et_PFOSA_AcOH)

# DESCRIBE LNPFAS DISTRIBUTION, ANTHRO DATASET
hist(PFAS_A$LNPFOS)
hist(PFAS_A$LNPFOA)
#hist(PFAS_A$LNPFOSA)
hist(PFAS_A$LNPFNA2)
hist(PFAS_A$LNPFHxS)
#hist(PFAS_A$LNPFDeA)
hist(PFAS_A$LNME_PFOSA)
hist(PFAS_A$LNET_PFOSA)


##### DESCRIBE PFAS DISTRIBUTION, ANTHRO + DXA DATASET
hist(PFAS_AD$PFOS)
hist(PFAS_AD$PFOA)
#hist(PFAS_AD$PFOSA)
hist(PFAS_AD$PFNA2)
hist(PFAS_AD$PFHxS)
#hist(PFAS_AD$PFDeA)
hist(PFAS_AD$Me_PFOSA_AcOH2)
hist(PFAS_AD$Et_PFOSA_AcOH)

# DESCRIBE LNPFAS DISTRIBUTION, ANTHRO + DXA DATASET
hist(PFAS_AD$LNPFOS)
hist(PFAS_AD$LNPFOA)
#hist(PFAS_AD$LNPFOSA)
hist(PFAS_AD$LNPFNA2)
hist(PFAS_AD$LNPFHxS)
#hist(PFAS_AD$LNPFDeA)
hist(PFAS_AD$LNME_PFOSA)
hist(PFAS_AD$LNET_PFOSA)

```

```{r}
##### DESCRIBE DISTRIBUTION OF OUTCOME MEASURES, ANTHRO DATASET
hist(PFAS_A$mom_bmi_MT)
hist(PFAS_A$mom_waist_ma17)
hist(PFAS_A$mom_hip_ma17)
hist(PFAS_A$mom_bodyfat_ma17)
hist(PFAS_A$mom_fat_ma17)
hist(PFAS_A$mom_weight_ma17)

# DESCRIBE THE LOG-DISTRIBUTION OF OUTCOME MEASURES, ANTHRO DATASET
hist(PFAS_A$LNBMI)
hist(PFAS_A$LNWAIST)
hist(PFAS_A$LNHIP)
hist(PFAS_A$LNBFAT)
hist(PFAS_A$LNFAT)
hist(PFAS_A$LNWT)


##### DESCRIBE DISTRIBUTION OF OUTCOME MEASURES, ANTHRO + DXA DATASET
hist(PFAS_AD$VAT_AREA_mdxa17)
hist(PFAS_AD$SAT_AREA_mdxa17)
hist(PFAS_AD$TAT_AREA_mdxa17)
hist(PFAS_AD$VAT_MASS_mdxa17)
hist(PFAS_AD$SAT_MASS_mdxa17)
hist(PFAS_AD$TAT_MASS_mdxa17)
hist(PFAS_AD$VAT_VOLUME_mdxa17)
hist(PFAS_AD$SAT_VOLUME_mdxa17)
hist(PFAS_AD$TAT_VOLUME_mdxa17)
hist(PFAS_AD$mom_bmi_MT)
hist(PFAS_AD$mom_waist_ma17)
hist(PFAS_AD$mom_hip_ma17)
hist(PFAS_AD$mom_bodyfat_ma17)
hist(PFAS_AD$mom_fat_ma17)
hist(PFAS_AD$mom_weight_ma17)

# DESCRIBE THE LOG-DISTRIBUTION OF OUTCOME MEASURES, ANTHRO + DXA DATASET
hist(PFAS_AD$LNVAT_AREA)
hist(PFAS_AD$LNSAT_AREA)
hist(PFAS_AD$LNTAT_AREA)
hist(PFAS_AD$LNVAT_MASS)
hist(PFAS_AD$LNSAT_MASS)
hist(PFAS_AD$LNTAT_MASS)
hist(PFAS_AD$LNVAT_VOLUME)
hist(PFAS_AD$LNSAT_VOLUME)
hist(PFAS_AD$LNTAT_VOLUME)
hist(PFAS_AD$LNWT)
hist(PFAS_AD$LNBMI)
hist(PFAS_AD$LNWAIST)
hist(PFAS_AD$LNHIP)
hist(PFAS_AD$LNBFAT)
hist(PFAS_AD$LNFAT)

```

```{r}
##### RENAME
PFAS$age_enroll <- PFAS$age_mom_enroll_d
PFAS$age_fu <- (PFAS$mom_age_days_mdxa17)/365
PFAS$fu_time <- (PFAS$age_days_mdxa17)/365
PFAS$exer <- PFAS$mod_pre_d + PFAS$vig_pre_d
PFAS$race <- PFAS$race2_mom_epi_epia_d
PFAS$edu <- PFAS$coll_grad
PFAS$bmi <- PFAS$bmi_mom_prepreg_d
PFAS$smoke <- PFAS$smokpreg_final_d
PFAS$income <- PFAS$income_hh_epq_epqa_d
PFAS$income_cat2 <- PFAS$gt70k
PFAS$parity <- PFAS$parity_d
PFAS$alc_bef <- PFAS$alc_d_bef_learn_f1
PFAS$alc_aft <- PFAS$alc_d_aft_learn_f1
PFAS$alc_tot <- PFAS$alc_d_f1


##### RE-LABEL 
PFAS$race <- ifelse(PFAS$race == "white", 0,
                     ifelse(PFAS$race == "black", 1,
                     ifelse(PFAS$race == "hispa", 2,
                     ifelse(PFAS$race == "asian", 3,
                     ifelse(PFAS$race == "other", 4, 4)))))
PFAS$edu <- ifelse(PFAS$edu == 1, 1, 0)
PFAS$bmi_cat <- ifelse(PFAS$bmi <18.5, 0,
                         ifelse(PFAS$bmi >=18.5 & PFAS$bmi < 25.0, 1, 
                         ifelse(PFAS$bmi >=25.0 & PFAS$bmi < 30.0, 2, 
                         ifelse(PFAS$bmi >=30.0 & PFAS$bmi < 35.0, 3,
                         ifelse(PFAS$bmi >=35.0, 4, 99)))))
PFAS$smoke <- ifelse(PFAS$smoke == "former", 0,
                         ifelse(PFAS$smoke == "smoke preg", 1,
                         ifelse(PFAS$smoke == "xnever", 2, 2)))
PFAS$income_cat2 <- ifelse(PFAS$income_cat2 == 1, 1, 0)
PFAS$income_cat3 <- ifelse(PFAS$income == 2, 0,
                       ifelse(PFAS$income == 3, 0,
                       ifelse(PFAS$income == 4, 0,
                       ifelse(PFAS$income == 5, 1,
                       ifelse(PFAS$income == 6, 2,0)))))
PFAS$parity <- ifelse(PFAS$parity == 0, 0,
                        ifelse(PFAS$parity == 1, 1,
                        ifelse(PFAS$parity > 1, 2, 0)))
PFAS$alc_bef <- ifelse(PFAS$alc_bef > 0, 1, 0)
PFAS$alc_aft <- ifelse(PFAS$alc_aft > 0, 1, 0)
PFAS$alc_tot <- ifelse(PFAS$alc_tot > 0, 1, 0)


##### REFACTOR
PFAS$race <- factor(PFAS$race,
                        levels = c(0, 1, 2, 3, 4),
                        labels = c("White", "Black", "Hispanic", "Asian", "Other/More than 1 race"))
PFAS$edu <- factor(PFAS$edu,
                       levels = c(0, 1),
                       labels = c(" < college degree", ">= college degree"))
PFAS$bmi_cat <- factor(PFAS$bmi_cat,
                       levels = c(0, 1, 2, 3, 4),
                       labels = c("Underweight (< 18.5)", "Normal weight (18.5 to 24.9)", 
                                  "Overweight (25.0 to 29.9)", "Obese (30.0 to 34.9)", 
                                  "Extremely obese (>= 35)"))
PFAS$smoke <- factor(PFAS$smoke,
                         levels = c(0, 1, 2),
                         labels = c("Former smoker", "Smoked during pregnancy", "Never smoked"))
PFAS$income_cat2 <- factor(PFAS$income_cat2,
                       levels = c(0, 1),
                       labels = c(" <= $70,000", "> $70,000"))
PFAS$income_cat3 <- factor(PFAS$income,
                          levels = c(0, 1, 2),
                          labels = c("<= $40,000", "$40,001-$70,000", "> $70,000"))
PFAS$parity <- factor(PFAS$parity,
                          levels = c(0, 1, 2),
                          labels = c("0", "1", ">= 2"))
PFAS$alc_bef <- factor(PFAS$alc_bef,
                          levels = c(0, 1),
                          labels = c("No", "Yes"))
PFAS$alc_aft <- factor(PFAS$alc_aft,
                          levels = c(0, 1),
                          labels = c("No", "Yes"))
PFAS$alc_tot <- factor(PFAS$alc_tot,
                          levels = c(0, 1),
                          labels = c("No", "Yes"))

##### LABEL
label(PFAS$age_enroll) <- "Maternal age at enrollment"
label(PFAS$age_fu) <- "Maternal age at follow-up"
label(PFAS$fu_time) <- "Follow-up time"
label(PFAS$exer) <- "Physical activity"
label(PFAS$race) <- "Race/Ethnicity"
label(PFAS$edu) <- "Education"
label(PFAS$bmi_cat) <- "Pre-pregnancy BMI"
label(PFAS$smoke) <- "Smoking status"
label(PFAS$income_cat2) <- "Annual household income"
label(PFAS$income_cat3) <- "Annual household income"
label(PFAS$parity) <- "Parity"
label(PFAS$alc_bef) <- "Consumed alcohol 3 months before learning about pregnancy"
label(PFAS$alc_aft) <- "Consumed alcohol during pregnancy"

##### ADD UNITS
units(PFAS$age_enroll)  <- "years"
units(PFAS$age_fu)  <- "years"
units(PFAS$age_dxa)  <- "years"
units(PFAS$bmi_cat)  <- "kg/m2"
units(PFAS$exer) <- "hrs/week"

##### TABE 1
table1(~ age_enroll + age_fu + age_dxa + exer + race + bmi_cat + edu + smoke + income_cat2 + 
         income_cat3 + parity + alc_bef + alc_aft + alc_tot,
       data = PFAS, overall="Total")

```

```{r}
##### PFAS DISTRIBUTION TABLE
summary(PFAS$PFOS)
summary(PFAS$PFOA)
summary(PFAS$PFNA2)
summary(PFAS$PFHxS)
summary(PFAS$Me_PFOSA_AcOH2)
summary(PFAS$Et_PFOSA_AcOH)

##### PFAS CORRELATION MATRIX
PFAS_corr <- PFAS[ , c("PFOS", "PFOA", "PFNA2", "PFHxS", "Me_PFOSA_AcOH2", "Et_PFOSA_AcOH")]
p_corr <- cor(PFAS_corr)
round(p_corr, 2)

corrplot(p_corr, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)

```

```{r}
##### OUTCOMES DISTRIBUTION TABLE
summary(PFAS$VAT_AREA_mdxa17)
summary(PFAS$SAT_AREA_mdxa17)
summary(PFAS$TAT_AREA_mdxa17)
summary(PFAS$WEIGHT_mdxa17)
summary(PFAS$mom_waist_ma17)
summary(PFAS$mom_bodyfat_ma17)

##### OUTCOMES CORRELATION MATRIX
OUTCOMES_corr <- PFAS[ , c("VAT_AREA_mdxa17", "SAT_AREA_mdxa17", "TAT_AREA_mdxa17", "WEIGHT_mdxa17", 
                       "mom_waist_ma17", "mom_bodyfat_ma17")]
o_corr <- cor(OUTCOMES_corr)
round(o_corr, 2)

corrplot(o_corr, type = "upper", order = "hclust", 
         tl.col = "black", tl.srt = 45)

corrplot.mixed(cor(o_corr),
               upper = "circle",
               tl.col = "black",
               addCoef.col = 'black')

```

```{r}
##### SAVE DATASET
write.csv(PFAS, file = "C:/Users/jarva/Desktop/James-Todd Lab/PFASandAdiposity/Data/PFAS_DEMO.csv", row.names = T)

```
